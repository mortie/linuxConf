#!/bin/bash

source ~/.mrecrc

if [ "$1" = "" ] && [ ! -f ~/.mrecname ]; then
	echo "mrec <name>"
	exit 1
elif [ "$1" = "" ]; then #stop recording
	sleep 5
	name=$(cat ~/.mrecname)
	pid=$(cat ~/.mrecpid)

	rm ~/.mrecname &>/dev/null
	rm ~/.mrecpid &>/dev/null

	URL="d.mort.coffee/vid/${name}.ogv"
	echo $URL | xsel -bi

	kill $pid

	while [ -e "/proc/$pid" ]; do sleep 0.1; done

	mupload ~/.mrecfile.ogv "vid/${name}.ogv"
else #start recording
	rm ~/.mrecfile.ogv &>/dev/null
	rm ~/.mrecname &>/dev/null
	rm ~/.mrecpid &>/dev/null
	sleep 0.2
	echo "$1" > ~/.mrecname

	recordmydesktop -x $X -y $Y --width $W --height $H -o ~/.mrecfile.ogv &
	echo $! > ~/.mrecpid
fi
