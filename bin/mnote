#!/bin/bash

if [ "$1" = "read" ]; then
	if [ "$2" = "" ]; then
		echo "Usage: mnote read <subject> <yyyy-mm-dd>"
		exit 1
	fi

	P="$HOME/notes/$2"
	C=""

	if [ "$3" = "" ]; then
		C=$(cat "$P/$(date +"%Y-%m-%d").md" | mnor | marked)

	elif [ "$3" = "all" ]; then
		for F in "$P"/*; do
			NAME="$(echo $F | rev | cut -d "/" -f 1 | rev | cut -d "." -f 1)"
			C=$(printf "$C\n\n# $NAME\n\n$(cat $F)\n")
		done

		C=$(echo "$C" | mnor | marked)

	else
		C=$(cat "$P/${3}.md" | mnor | marked)
	fi


	echo "$C" | w3m -T text/html
	exit 0
fi

P=~/notes/$1
if [[ ! -d "$P" ]]; then
	echo "$P doesn't exist. Create it? [y/n]"
	read response
	if [ "$response" != "y" ]; then
		echo "Aborting."
		exit 1
	fi

	mkdir -p "$P"
fi

D=""
if [ "$2" = "" ]; then
	D=$(date +"%Y-%m-%d")
else
	D="$2"
fi

vim "$P/${D}.md"
