#!/bin/sh
if [ "$1" = "" ]; then
	cmd=$(dmenu_path | dmenu)
else
	cmd=$(dmenu -p "$1" <<< "$")
	if [ "$cmd" = "$" ]; then
		exit 0
	fi
fi

if [ "$cmd" = "" ]; then
	exit 0
fi

if [ "$1" = "" ] && which $(cut -d ' ' -f 1 <<< "$cmd") 2>/dev/null; then
	sh <<< "$cmd"
else
	if [ "$1" != "" ]; then
		cmd="$1 $cmd"
	fi

	ans=$(python -c "print($cmd)")
	if [ $? = 0 ]; then
		$0 "$ans" # Rerun with previous output as input
	fi
fi
